---
{
  "title": "203.1: MeshTxBuilder - Introduction & Send Lovelace",
  "slt": ["203.1"],
  "type": "Lesson",
  "description": "I can build a transaction to send lovelace using lower level transaction APIs.",
  "videoURL": "",
  "lastEdited": "24 Feb 2024",
  "author": "Write: Leon, Review: Hinson"
}
---

## Introduction

In the [Transactions Instance](/course/module/200/2001) module, you learned how to build a transaction to send lovelace using the Mesh Transaction Instance which you will imitate and build a similar transaction using the lower level transaction APIs provided by MeshTxBuilder in this lesson.

---

### Step 1: Setting up the MeshTxBuilder instance

To start building customized transactions using MeshTxBuilder, you have to first initialize a `MeshTxBuilder` instance with a [Cardano APIs Provider](https://meshjs.dev/providers), such as [Maestro](https://meshjs.dev/providers/maestro) in the following case.

```typescript
import { MaestroProvider, MeshTxBuilder } from "@meshsdk/core";

const maestro = new MaestroProvider({
  network: "Preprod",
  apiKey: YOUR_MAESTRO_API_KEY,
});

const mesh = new MeshTxBuilder({
  fetcher: maestro,
  submitter: maestro,
  evaluator: maestro,
});
```

You can pass in 4 optional fields to the `MeshTxBuilder` constructor to customize your instance according to your project. They are `fetcher`, `submitter`, `evaluator`, and `isHydra` respectively. 

To learn more, the `fetcher` is used to fetch information from the blockchain. The `submitter` is used to directly call the submitTx API. The `evaluator` is used for redeemer execution unit optimization. The `isHydra` could be set to use another set of default protocol parameters for transactions building. You can initialize the instance with the `maestro` provider for now as shown in the example above.

---

### Step 2: Get the UTxOs of the Sender's Address

To build a transaction to send fund, you have to first find the UTxOs with enough lovelace to be used in the transaction to cover the amount and fee incurred. 

Here is an example on how to do it:

```typescript
const getUtxosWithMinLovelace = async (lovelace: number) => {
  let utxos: UTxO[] = await maestro.fetchAddressUTxOs(address!);
  return utxos.filter((utxo) => {
    const lovelaceAmount = utxo.output.amount.find(
      (asset: any) => asset.unit === "lovelace"
    )?.quantity;
    return Number(lovelaceAmount) > lovelace;
  });
};
```

The function first fetch the UTxOs of the address from Maestro which you could also get using other methods. Then it just need to filter out the UTxOs that are lovelace and have quantity greater than the required amount.

---

### Step 3: Building a Transaction to Send Fund

Now you can start building the transaction to send fund. Here is an example on how to do it:

```typescript
const sendFund = async () => {
  const utxos = await getUtxosWithMinLovelace(10000000);
  const txInHash = utxos[0].input.txHash;
  const txInId = utxos[0].input.outputIndex;
  await mesh
    .txIn(txInHash, txInId)
    .txOut(RECIPIENT_ADDRESS, [{ unit: "lovelace", quantity: "5000000" }])
    .changeAddress(RECIPIENT_ADDRESS)
    .signingKey(SIGNING_KEY)
    .complete();

  const signedTx = mesh.completeSigning();

  const txHash = await mesh.submitTx(signedTx);

  console.log("txHash", txHash);
};
```

In the provided code, you first called the function created in the previous step to get the UTxOs with adequate lovelace. Then, you can just use the first UTxO in the acquired array to set the input for the transaction in `txIn`. Consequently, you can set the output of the transaction in `txOut` with your recipient's address and the amount of lovelace you would like to send. You also have to configure the `changeAddress` to accept change UTxO from the transaction. To sign the transaction, you would need to provide your `signingKey` in CBOR hex format. Finally. you can use `complete` to finish building the transaction where the `MeshTxBuilder` instance will analyze and serialize the transaction if it is valid. 

After that, you can call `completeSigning` to sign the transaction with the signing key you provided which it could be submitted to the blockchain using  `submitTx`.

---

### Step 4: Run and Test your Code

The complete code should be something like the following example:

```typescript
import { MaestroProvider, MeshTxBuilder, UTxO } from "@meshsdk/core";
import { useAddress } from "@meshsdk/react";

export default function Course2031() {
  const address = useAddress();

  const maestro = new MaestroProvider({
    network: "Preprod",
    apiKey: YOUR_MAESTRO_API_KEY,
  });

  const mesh = new MeshTxBuilder({
    fetcher: maestro,
    submitter: maestro,
    evaluator: maestro,
  });

  const getUtxosWithMinLovelace = async (lovelace: number) => {
    let utxos: UTxO[] = await maestro.fetchAddressUTxOs(address!);
    return utxos.filter((utxo) => {
      const lovelaceAmount = utxo.output.amount.find(
        (asset: any) => asset.unit === "lovelace"
      )?.quantity;
      return Number(lovelaceAmount) > lovelace;
    });
  };

  const sendFund = async () => {
    const utxos = await getUtxosWithMinLovelace(10000000);
    const txInHash = utxos[0].input.txHash;
    const txInId = utxos[0].input.outputIndex;
    await mesh
      .txIn(txInHash, txInId)
      .txOut(address!, [{ unit: "lovelace", quantity: "5000000" }])
      .changeAddress(address!)
      .signingKey("your_signing_key")
      .complete();

    const signedTx = mesh.completeSigning();

    const txHash = await mesh.submitTx(signedTx);

    console.log("txHash", txHash);
  };

  return (
    <div className="p-3">
      <button className="m-2 p-2 bg-slate-500" onClick={sendFund}>
        Send Fund To Self
      </button>
    </div>
  );
}
```

Now run the application with `npm run dev` and open a browser, go to the URL `http://localhost:3000`. You will see a `Send Fund To Self` button. It should build a transaction to send fund to the address of the wallet currently connected when clicked.

You can modify the code examples in this module according to your project ideas. Feel free to make modifications and create something different while applying the same principles from code example above to practice your skills as a developer.

---
